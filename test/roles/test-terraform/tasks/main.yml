- name: "generate test timestamp"
  set_fact:
    test_timestamp: "{{lookup('pipe','date +%Y%m%d%H%M%S')}}"

- name: "render tfvars"
  template:
  args:
    src: "{{playbook_dir}}/secrets-kubenow/tfvars/{{host_cloud}}.tfvars.j2"
    dest: "{{playbook_dir}}/../terraform.tfvars"

- name: "terraform get {{host_cloud}}"
  command: terraform get {{host_cloud}}
  args:
    chdir: "{{playbook_dir}}/.."
  notify: "terraform destroy {{host_cloud}}"

- name: "terraform apply {{host_cloud}}"
  command: terraform apply {{host_cloud}}
  args:
    chdir: "{{playbook_dir}}/.."
